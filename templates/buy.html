{% extends "layout.html" %}

{% block title %}
    FoxAI Image Generator
{% endblock %}

{% block main %}
<div class="container">
    <!-- Image Generation Form Section -->
    <div class="row my-4">
        <div class="col-md-6">
            <h2>Start Generating Foxai Images</h2>
            <p>Enter your requirements below to get customized images for your web projects.</p>

            <form id="imageForm" action="/generate-image" method="post" class="form-signin" onsubmit="return handleImageGeneration()">
                <div class="mb-3">
                    <textarea class="form-control" name="image_description" placeholder="Describe the image you need" rows="3" required></textarea>
                </div>
                <!-- Additional fields for image style, dimensions, etc. -->
                <!-- ... -->

                <!-- Inside the form -->
                <button class="btn btn-primary mt-2" type="submit" id="generateButton">
                    <span id="generateText">Generate Image</span>
                    <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                </button>
            </form>
        </div>

        <!-- Image Preview Section -->
        <div class="col-md-6">
            <div class="text-center">
                <h2>Image Preview</h2>
                <!-- Add a link to the generated image with the "lightbox" class -->
                <a href="#" id="preview-link" data-lightbox="image-preview">
                    <img id="preview-img" src="#" alt="Image preview" class="img-fluid mb-3">
                </a>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="downloadImage()">Download</button>
                    <button class="btn btn-secondary" onclick="renameImage()">Rename</button>
                    <button class="btn btn-secondary" onclick="regenerateImage()">Regenerate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Existing Buy Form Section -->
    <div class="row mt-5">
        <div class="col-md-12">
            <h4 class="text-left">Stock Purchase (Existing Functionality)</h4>
            <form action="/buy" method="post" class="form-inline justify-content-center">
                <div class="form-group mx-2">
                    <input autocomplete="off" class="form-control" name="symbol" placeholder="Stock Symbol" type="text" required>
                </div>
                <div class="form-group mx-2">
                    <input class="form-control" name="shares" placeholder="Number of Shares" type="number" min="1" required>
                </div>
                <button class="btn btn-dark mx-2" type="submit">
                    Buy
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Include Lightbox2 JS file -->
<script src="/static/lightbox.min.js"></script>

<script>
    // JavaScript functions for image actions
    function downloadImage() {
        // Implement image download functionality
    }

    function renameImage() {
        // Implement image renaming functionality
    }

    function handleImageGeneration() {
        // Show loading spinner
        document.getElementById('loadingSpinner').classList.remove('d-none');
        document.getElementById('generateText').innerText = 'Generating...';

        // Fetch the generated image URL from the API response
        fetch('/generate-image', {
            method: 'POST',
            body: new FormData(document.getElementById('imageForm')),
        })
        .then(response => response.json())
        .then(data => {
            // Update the image preview link and image URL
            document.getElementById('preview-link').href = data.image_url;
            document.getElementById('preview-img').src = data.image_url;

            // Hide loading spinner after image is loaded
            document.getElementById('loadingSpinner').classList.add('d-none');
            document.getElementById('generateText').innerText = 'Generate Image';
        })
        .catch(error => {
            console.error('Error:', error);
            
            // Hide loading spinner in case of an error
            document.getElementById('loadingSpinner').classList.add('d-none');
            document.getElementById('generateText').innerText = 'Generate Image';
        });

        // Prevent the form from submitting
        return false;
    }

    function regenerateImage() {
        // Submit the image generation form
        document.getElementById('imageForm').submit();
    }
</script>
{% endblock %}
